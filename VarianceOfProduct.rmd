---
title: "Variance of a product"
author: "Beth Babcock"
date: "`r Sys.Date()`"
output: html_document
---

If x and y are variables, and $z=xy$ then the variance of z can be calculated from the means and variances of the x and y as:

$$\sigma^2_z=\mu_x^2\sigma^2_y+\mu_y^2\sigma^2_x-2\mu_x\mu_y\sigma_{xy}$$

If x and y are indpendent then their covarinace $\sigma_{xy}$ is zero, and the formula reduces to:
$$\sigma^2_z=\mu_x^2\sigma^2_y+\mu_y^2\sigma^2_x$$

For delta-lognormal abundance index estimation, Lo et al. (1992) introduced a method where the covariance is approximated by the covariance in the two variables among years, as shown in this function.

```{r}
#' Variance of a product from Lo et al. (1992)
#'
#' @param x1 mean of variable one
#' @param x1e standard error or variable 1
#' @param x2 mean of variable 2
#' @param x2e standard error of variable 2
#' @keywords internal
lo.se=function(x1,x1e,x2,x2e) {
  if(length(x1[!is.na(x1) &!is.na(x2)])>1 & length(unique(x1))>1 & length(unique(x2))>1 )
   cor12=cor(x1[!is.na(x1) &!is.na(x2)],x2[!is.na(x1) &!is.na(x2)]) else cor12=0
  (x1e^2 * x2^2 +x2e^2*x1^2+2*x1*x2*cor12*x1e*x2e)^0.5
}

```






